############################################################################
# Makefile to compile the package within DFTB+
#
# Receives:
#     ROOT: Root of the source directory
#     BUILDROOT: Root of the build directory
#
############################################################################

.SUFFIXES:
.SUFFIXES: .f90 .c .o

include $(ROOT)/make.config

OBJDIR := $(BUILDROOT)/external/countdevice
SRCDIR := $(ROOT)/external/countdevice
STAMPFILE := $(OBJDIR)/BUILD_TIMESTAMP

vpath % $(SRCDIR)

CSRC = $(notdir $(wildcard $(SRCDIR)/*.cpp))
F90SRC = $(notdir $(wildcard $(SRCDIR)/*.f90))
CDEVICEOBJS = $(patsubst %.cpp,%.o,$(CSRC)) 
FDEVICEOBJS = $(patsubst %.f90,%.o,$(F90SRC))


.PHONY: all
all: libcountdevice.a
	touch -r $<  $(OBJDIR)/libcountdevice.a $(STAMPFILE)

libcountdevice.a: $(FDEVICEOBJS) $(CDEVICEOBJS) 
	ar rcs $@ $^

PHONY: clean
clean:
	rm -f *.o *.mod *.a

%.o: %.f90
	$(FXX) -c $<

%.o: %.cpp
	$(CXX) $(CXXOPT) $(LDFLAGS) -c $<

