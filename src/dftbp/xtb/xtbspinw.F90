!--------------------------------------------------------------------------------------------------!
!  DFTB+: general package for performing fast atomistic simulations                                !
!  Copyright (C) 2006 - 2025  DFTB+ developers group                                               !
!                                                                                                  !
!  See the LICENSE file for terms of usage and distribution.                                       !
!--------------------------------------------------------------------------------------------------!

#:include 'error.fypp'

!> Spin constants for the xTB model
!! https://onlinelibrary.wiley.com/doi/10.1002/jcc.27185
module dftbp_xtb_xtbspinw
  use dftbp_common_accuracy, only : dp
  use dftbp_common_status, only : TStatus
  implicit none

  private
  public :: wvalues, spindx

  !> Indexing for l values against spin constant location
  integer, parameter :: spindx(0:2,0:2) = reshape([1,2,4,2,3,5,4,5,6],[3,3])

  ! Spin constants for H - Rn, note the Ln series are missing from 58 - 71
  ! Ordering Wss, Wsp, Wpp, Wsd, Wpd, Wdd
  real(dp), parameter :: wdata(6, 72) = reshape([&
      & -0.071550, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000,&
      & -0.614675, -0.033587, -0.125800, 0.000000, 0.000000, 0.000000,&
      & -0.017775, -0.013937, -0.018050, 0.000000, 0.000000, 0.000000,&
      & -0.022850, -0.018612, -0.017575, 0.000000, 0.000000, 0.000000,&
      & -0.027325, -0.022037, -0.019600, 0.000000, 0.000000, 0.000000,&
      & -0.030200, -0.025025, -0.022725, 0.000000, 0.000000, 0.000000,&
      & -0.033000, -0.027475, -0.025475, 0.000000, 0.000000, 0.000000,&
      & -0.035100, -0.029500, -0.027825, 0.000000, 0.000000, 0.000000,&
      & -0.036900, -0.031200, -0.029900, 0.000000, 0.000000, 0.000000,&
      & -0.055008, -0.012830, -0.022600, -0.011925, -0.016737, -0.080725,&
      & -0.015100, -0.013337, -0.023025, 0.000000, 0.000000, 0.000000,&
      & -0.016500, -0.013175, -0.017400, 0.000000, 0.000000, 0.000000,&
      & -0.018250, -0.013837, -0.014000, -0.008175, -0.011637, -0.012875,&
      & -0.019525, -0.015000, -0.014350, -0.008437, -0.011637, -0.014075,&
      & -0.020550, -0.016112, -0.014900, -0.009300, -0.011975, -0.014825,&
      & -0.021325, -0.017012, -0.015500, -0.009987, -0.012137, -0.014950,&
      & -0.021825, -0.017712, -0.016075, -0.010987, -0.012612, -0.015075,&
      & -0.342475, -0.077825, -0.120675, -0.015500, -0.023075, -0.051925,&
      & -0.010650, -0.010900, -0.016375, 0.000000, 0.000000, 0.000000,&
      & -0.011800, -0.010387, -0.013350, -0.005562, -0.003512, -0.010200,&
      & -0.012725, -0.010912, -0.013850, -0.004787, -0.002412, -0.012525,&
      & -0.013525, -0.011225, -0.014675, -0.004350, -0.001975, -0.013900,&
      & -0.014075, -0.011512, -0.015275, -0.004037, -0.001725, -0.014900,&
      & -0.015175, -0.012450, -0.021225, -0.004150, -0.001662, -0.013875,&
      & -0.015000, -0.011787, -0.016725, -0.003550, -0.001325, -0.016525,&
      & -0.015400, -0.011925, -0.017850, -0.003300, -0.001162, -0.017125,&
      & -0.015825, -0.012037, -0.018700, -0.003137, -0.001050, -0.017750,&
      & -0.016150, -0.012175, -0.019700, -0.002987, -0.000950, -0.018300,&
      & -0.017150, -0.013175, -0.030375, -0.002775, -0.000650, -0.017475,&
      & -0.016850, -0.012312, -0.021450, 0.000000, 0.000000, 0.000000,&
      & -0.017225, -0.012787, -0.013400, -0.008525, -0.013000, -0.015775,&
      & -0.017550, -0.013375, -0.013575, -0.008112, -0.012825, -0.017525,&
      & -0.017750, -0.013762, -0.013600, -0.007987, -0.012387, -0.017550,&
      & -0.017975, -0.014087, -0.013625, -0.008162, -0.011962, -0.017200,&
      & -0.018100, -0.014375, -0.013725, -0.008275, -0.011762, -0.016675,&
      & -0.299025, -0.066587, -0.101875, -0.012575, -0.021287, -0.048300,&
      & -0.009550, -0.009600, -0.016725, 0.000000, 0.000000, 0.000000,&
      & -0.010650, -0.009237, -0.012525, 0.000000, 0.000000, 0.000000,&
      & -0.011425, -0.009487, -0.012300, -0.006725, -0.003987, -0.009725,&
      & -0.011950, -0.009612, -0.013525, -0.006150, -0.003075, -0.010725,&
      & -0.012575, -0.010262, -0.019075, -0.006062, -0.002887, -0.010475,&
      & -0.012925, -0.010500, -0.022225, -0.005562, -0.002362, -0.010925,&
      & -0.013150, -0.010662, -0.024725, -0.005112, -0.002025, -0.011300,&
      & -0.013375, -0.010750, -0.027500, -0.004750, -0.001662, -0.011625,&
      & -0.013525, -0.010912, -0.032025, -0.004400, -0.001425, -0.011875,&
      & -0.018975, -0.023937, -0.180200, -0.002087, -0.001487, -0.011325,&
      & -0.013925, -0.011100, -0.039800, -0.003887, -0.001012, -0.012400,&
      & -0.013850, -0.010500, -0.019650, 0.000000, 0.000000, 0.000000,&
      & -0.014125, -0.010550, -0.011575, -0.005062, -0.009375, -0.010100,&
      & -0.014300, -0.010912, -0.011675, -0.004600, -0.009125, -0.011875,&
      & -0.014525, -0.011125, -0.011650, -0.004375, -0.008725, -0.012525,&
      & -0.014525, -0.011237, -0.011550, -0.004137, -0.008162, -0.012250,&
      & -0.014575, -0.011337, -0.011450, -0.004450, -0.008312, -0.012825,&
      & -0.255850, -0.055587, -0.085625, -0.004662, -0.013337, -0.037350,&
      & -0.008200, -0.008575, -0.015300, 0.000000, 0.000000, 0.000000,&
      & -0.009275, -0.008200, -0.011250, 0.000000, 0.000000, 0.000000,&
      & -0.009925, -0.008412, -0.011400, -0.005925, -0.003312, -0.009025,&
      & -0.012175, -0.009625, -0.012600, -0.007637, -0.004187, -0.010425,&
      & -0.012325, -0.009575, -0.013375, -0.007137, -0.003475, -0.010925,&
      & -0.012500, -0.009562, -0.014450, -0.006725, -0.002950, -0.011225,&
      & -0.012600, -0.009662, -0.014800, -0.006275, -0.002600, -0.011450,&
      & -0.012600, -0.009200, -0.020600, -0.005950, -0.002075, -0.011550,&
      & -0.012725, -0.009275, -0.021000, -0.005700, -0.001912, -0.011650,&
      & -0.013075, -0.010212, -0.033575, -0.005550, -0.001812, -0.011150,&
      & -0.013150, -0.009962, -0.053000, -0.005287, -0.001462, -0.011175,&
      & -0.013025, -0.009187, -0.029250, 0.000000, 0.000000, 0.000000,&
      & -0.013275, -0.009112, -0.010725, 0.000000, 0.000000, 0.000000,&
      & -0.013475, -0.009350, -0.010975, 0.000000, 0.000000, 0.000000,&
      & -0.013625, -0.009537, -0.010975, 0.000000, 0.000000, 0.000000,&
      & -0.013725, -0.009625, -0.010850, 0.000000, 0.000000, 0.000000,&
      & -0.013775, -0.009737, -0.010725, -0.002612, -0.007362, -0.011925,&
      & -0.254400, -0.050400, -0.080625, -0.001087, -0.011050, -0.035175&
      & ], [6, 72])

contains

  !> Returns spin constants for a
  subroutine wvalues(W, iZ, errStatus)

    !> Spin constants
    real(dp), intent(out) :: W(6)

    !> Atomic number
    integer, intent(in) :: iZ

    !> Status of operation
    type(TStatus), intent(out) :: errStatus

    W(:) = 0.0_dp
    if (iZ < 1) then
      @:RAISE_ERROR(errStatus, -1, "Unknown element")
    else if (iZ < 58) then
      W(:) = wdata(:, iZ)
    else if (iZ < 72) then
      W(:) = wdata(:, 57)
    else if (iZ < 87) then
      W(:) = wdata(:, iZ - 14)
    else
      @:RAISE_ERROR(errStatus, -1, "Unknown element")
    end if

  end subroutine wvalues

end module dftbp_xtb_xtbspinw
